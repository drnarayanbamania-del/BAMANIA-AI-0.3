<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bamania AI</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #030712;
      color: #e5e7eb;
      font-family: system-ui, sans-serif;
    }
    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .logo {
      background: linear-gradient(135deg,#60a5fa,#2563eb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center">

  <!-- LOGIN CARD -->
  <div class="card rounded-xl p-8 w-[320px] text-center space-y-4">

    <h1 class="text-3xl font-bold logo">BAMANIA AI</h1>
    <p id="statusText" class="text-sm text-gray-400">
      Offline Mode Â· Guest
    </p>

    <button
      onclick="googleLogin()"
      class="w-full py-2 rounded bg-blue-500 hover:bg-blue-600 transition text-white font-medium"
    >
      Login with Google
    </button>

    <p class="text-sm">
      Credits Left:
      <span id="creditsLeft">0</span>
    </p>

    <button
      onclick="useCredit()"
      id="useBtn"
      disabled
      class="w-full py-2 rounded bg-red-500 opacity-50 cursor-not-allowed text-white"
    >
      Use Credit
    </button>
  </div>

  <!-- ðŸ”¥ FIREBASE LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signInWithRedirect,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB112az1gQpxM310bk9DH7iqSGsHDLb5jM",
      authDomain: "bamania-ai-0-3.firebaseapp.com",
      projectId: "bamania-ai-0-3",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const creditsEl = document.getElementById("creditsLeft");
    const statusEl = document.getElementById("statusText");
    const useBtn = document.getElementById("useBtn");

    // ðŸ” LOGIN
    window.googleLogin = async () => {
      const provider = new GoogleAuthProvider();
      try {
        await signInWithPopup(auth, provider);
      } catch (e) {
        console.warn("Popup blocked, redirecting...");
        await signInWithRedirect(auth, provider);
      }
    };

    // ðŸ‘¤ AUTH STATE
    onAuthStateChanged(auth, async (user) => {
      if (!user) return;

      statusEl.textContent = "Logged in as " + user.email;

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        await setDoc(ref, {
          credits: 5,
          createdAt: Date.now()
        });
        creditsEl.textContent = 5;
      } else {
        creditsEl.textContent = snap.data().credits;
      }

      toggleUseBtn();
    });

    // âž– USE CREDIT
    window.useCredit = async () => {
      const user = auth.currentUser;
      if (!user) return alert("Login required");

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

      if (!snap.exists()) return;

      const left = snap.data().credits;
      if (left <= 0) return alert("No credits left");

      await updateDoc(ref, { credits: left - 1 });
      creditsEl.textContent = left - 1;
      toggleUseBtn();
    };

    function toggleUseBtn() {
      const c = Number(creditsEl.textContent);
      useBtn.disabled = c <= 0;
      useBtn.classList.toggle("opacity-50", c <= 0);
      useBtn.classList.toggle("cursor-not-allowed", c <= 0);
    }
  </script>

</body>
</html>
